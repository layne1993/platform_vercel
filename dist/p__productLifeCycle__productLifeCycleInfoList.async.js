(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[56],{"/ONL":function(e,t,a){"use strict";a.r(t);a("IzEo");var n=a("bx4M"),l=a("0Owb"),r=(a("14J3"),a("BMrR")),c=(a("+L6B"),a("2/Rp")),o=(a("OaEy"),a("2fM7")),i=(a("iQDF"),a("+eQT")),s=(a("5NDa"),a("5rEg")),d=(a("jCWc"),a("kPKH")),u=(a("2qtc"),a("kLXV")),m=a("k1fw"),p=(a("DYRE"),a("zeV3")),f=(a("Awhp"),a("KrTs")),g=(a("5Dmo"),a("3S7+")),h=a("fWQN"),E=a("mtLc"),w=a("yKVA"),C=a("879j"),y=(a("/xke"),a("TeRw")),b=(a("y8nQ"),a("Vl3Y")),I=a("Hx5s"),v=a("RCxd"),O=a("q1tI"),D=a.n(O),F=a("9kvl"),L=a("nT/m"),T=a("+n12"),R=a("tQHx"),x=a("tJVT"),k=function(e,t,a,n){var l=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3;y["default"][e||"info"]({message:t,description:a,placement:n,duration:l||3})},N=function(e){var t=e.flag,a=e.loading,n=e.onClose,l=e.goProductDetail,i=e.onSuccess,s=e.dispatch,d=b["a"].useForm(),m=Object(x["a"])(d,1),f=m[0],g=Object(O["useState"])([]),h=Object(x["a"])(g,2),E=h[0],w=h[1],C=Object(O["useState"])([]),y=Object(x["a"])(C,2),I=y[0],v=y[1],L=Object(O["useState"])(!1),T=Object(x["a"])(L,2),R=T[0],N=T[1],S=function(){s({type:"PRODUCTLIFECYCLEINFO/queryLifeCycleTemplateList",payload:{},callback:function(e){if(1008===e.code)w(e.data||[]);else{var t=e.message||e.data||"\u67e5\u8be2\u5931\u8d25";k("error","\u63d0\u793a\uff08\u4ee3\u7801\uff1a".concat(e.code,"\uff09"),t,"topRight")}}})},j=function(){s({type:"PRODUCTLIFECYCLEINFO/queryByProductName",payload:{},callback:function(e){if(1008===e.code)v(e.data||[]);else{var t=e.message||e.data||"\u67e5\u8be2\u5931\u8d25";k("error","\u63d0\u793a\uff08\u4ee3\u7801\uff1a".concat(e.code,"\uff09"),t,"topRight")}}})};Object(O["useEffect"])(S,[]),Object(O["useEffect"])(j,[]);var P=function(e){var t=e.productInfo,a=e.lifecycleTemplateInfo;s({type:"PRODUCTLIFECYCLEINFO/createLifeCycleProcess",payload:{lifecycleTemplateId:null===a||void 0===a?void 0:a.value,templateName:null===a||void 0===a?void 0:a.label,productFullName:null===t||void 0===t?void 0:t.label,productId:null===t||void 0===t?void 0:t.value},callback:function(e){var t=e.code,a=e.data;if(1008===t)F["c"].push("/productLifeCycleInfo/list/processDetails/".concat(a.lifecycleFlowId)),i();else{var n=e.message||e.data||"\u521b\u5efa\u5931\u8d25\uff01";k("error","\u63d0\u793a\uff08\u4ee3\u7801\uff1a".concat(e.code,"\uff09"),n,"topRight")}}})},Y=function(e){console.log(e);var t=E.filter((function(t){return t.lifecycleTemplateId===e.value}))||[],a=t.length&&t[0].relatedProducts||!1;N(!!a)};return D.a.createElement(u["a"],{title:"\u521b\u5efa\u6d41\u7a0b",visible:t,footer:null,onCancel:n},D.a.createElement(b["a"],{layout:"vertical",form:f,onFinish:P},D.a.createElement(b["a"].Item,{label:"\u521b\u5efa\u6d41\u7a0b",name:"lifecycleTemplateInfo",rules:[{required:!0,message:"\u8bf7\u9009\u62e9"}]},D.a.createElement(o["a"],{showSearch:!0,allowClear:!0,placeholder:"\u8bf7\u9009\u62e9\u6a21\u677f",style:{maxWidth:400},labelInValue:!0,onChange:Y,filterOption:function(e,t){return t.children.toLowerCase().indexOf(e.toLowerCase())>=0}},E.map((function(e){return D.a.createElement(o["a"].Option,{value:e.lifecycleTemplateId,key:e.lifecycleTemplateId},e.templateName)})))),R?D.a.createElement(b["a"].Item,{label:D.a.createElement("span",null,"\u8bf7\u5173\u8054\u4ea7\u54c1",D.a.createElement("a",{onClick:function(){l({productId:0}),n()}},"\u6dfb\u52a0\u4ea7\u54c1")),name:"productInfo",rules:[{required:R,message:"\u8bf7\u9009\u62e9"}]},D.a.createElement(o["a"],{allowClear:!0,showSearch:!0,placeholder:"\u8bf7\u9009\u62e9\u4ea7\u54c1",style:{maxWidth:400},labelInValue:!0,filterOption:function(e,t){return t.children.toLowerCase().indexOf(e.toLowerCase())>=0}},I.map((function(e){return D.a.createElement(o["a"].Option,{value:e.productId,key:e.productId},e.productName)})))):null,D.a.createElement(r["a"],{justify:"center"},D.a.createElement(p["b"],null,D.a.createElement(c["a"],{onClick:n},"\u53d6\u6d88"),D.a.createElement(c["a"],{loading:a,type:"primary",htmlType:"submit"},"\u786e\u5b9a")))))},S=Object(F["b"])((function(e){var t=e.loading;return{loading:t.effects["PRODUCTLIFECYCLEINFO/createLifeCycleProcess"]}}))(N);N.defaultProps={flag:!1};var j=a("QWqi"),P=a("wd/R"),Y=a.n(P),M=b["a"].Item,U={labelCol:{xs:{span:8},sm:{span:8}},wrapperCol:{xs:{span:16},sm:{span:16}}},K=function(e,t,a,n){var l=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3;y["default"][e||"info"]({message:t,description:a,placement:n,duration:l||3})},q={1:"#FDC854",2:"#EB4C47",3:"#188FFF"},V="YYYY-MM-DD: HH:mm:ss",_=Object(T["o"])(40100),H=_.authEdit,Q=(_.authExport,function(e){Object(w["a"])(a,e);var t=Object(C["a"])(a);function a(e){var n;return Object(h["a"])(this,a),n=t.call(this,e),n.formRef=D.a.createRef(),n.columns=[{title:"\u6d41\u7a0b\u6807\u9898",dataIndex:"processTitle",width:200,ellipsis:!0,render:function(e,t){return e?D.a.createElement(g["a"],{placement:"topLeft",title:e},D.a.createElement("a",{style:{width:80,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},onClick:function(){return n.goDetail(t)}},e)):"--"}},{title:"\u6a21\u677f\u540d\u79f0",dataIndex:"templateName",width:200,render:function(e){return e||"--"}},{title:"\u5173\u8054\u4ea7\u54c1",dataIndex:"productFullName",width:200,render:function(e){return e||"--"}},{title:"\u72b6\u6001",dataIndex:"flowStatus",width:80,render:function(e){return e?D.a.createElement(f["a"],{color:q[e],text:Object(T["x"])(L["y"])[e]}):"--"}},{title:"\u5f53\u524d\u8282\u70b9\u5e8f\u53f7",dataIndex:"sequence",width:110,render:function(e){return e||"--"}},{title:"\u5f53\u524d\u8282\u70b9\u540d\u79f0",dataIndex:"nodeName",width:200,render:function(e){return e||"--"}},{title:"\u5f53\u524d\u8282\u70b9\u53d1\u8d77\u65f6\u95f4",dataIndex:"startDate",width:200,render:function(e){return e?Y()(e).format(V):"--"},sorter:function(e,t){return e.startDate-t.startDate},ellipsis:!0},{title:"\u5904\u7406\u4eba",dataIndex:"managerUserName",width:100,ellipsis:!0,render:function(e){return e?D.a.createElement(g["a"],{title:e},D.a.createElement("p",{style:{width:80,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}},e)):"--"}},{title:"\u5907\u6ce8",dataIndex:"auditOpinion",width:100,ellipsis:!0,render:function(e){return e||"--"}},{title:"\u521b\u5efa\u65f6\u95f4",dataIndex:"createTime",width:120,render:function(e){return e?Y()(e).format(V):"--"},sorter:function(e,t){return e.createTime-t.createTime},ellipsis:!0},{title:"\u64cd\u4f5c",width:100,render:function(e){return D.a.createElement(p["b"],null,H&&D.a.createElement("a",{onClick:function(){return n.cancelPre([e.lifecycleFlowId])}},"\u64a4\u9500"),D.a.createElement("a",{onClick:function(){return n.goDetail(e)}},"\u8be6\u60c5"))}}],n.getListData=function(){var e=n.props.dispatch,t=n.formRef.current.getFieldsValue(),a=n.state.pageData;e({type:"PRODUCTLIFECYCLEINFO/getListData",payload:Object(m["a"])(Object(m["a"])(Object(m["a"])({},t),a),{},{createTime:t.createTime?Y()(t.createTime).format("YYYY-MM-DD"):void 0}),callback:function(e){if(1008===e.code)n.setState({dataSource:e.data||{}});else{var t=e.message||e.data||"\u67e5\u8be2\u5931\u8d25\uff01";K("warning","\u63d0\u793a(\u4ee3\u7801\uff1a".concat(e.code,")"),t,"topRight")}}})},n.getHandlePersion=function(){var e=n.props.dispatch;e({type:"PRODUCTLIFECYCLEINFO/getAdminUserList",payload:{},callback:function(e){if(1008===e.code)n.setState({handlePersion:e.data||{}});else{var t=e.message||e.data||"\u67e5\u8be2\u5931\u8d25\uff01";K("warning","\u63d0\u793a(\u4ee3\u7801\uff1a".concat(e.code,")"),t,"topRight")}}})},n.doCancel=function(e){var t=n.props.dispatch;t({type:"PRODUCTLIFECYCLEINFO/repealLifeCycleProcess",payload:{lifecycleFlowIdList:e},callback:function(e){if(1008===e.code)K("success","\u6210\u529f","\u64a4\u9500\u6210\u529f","topRight"),n.getListData();else{var t=e.message||e.data||"\u64cd\u4f5c\u5931\u8d25\uff01";K("warning","\u63d0\u793a\uff08\u4ee3\u7801\uff1a".concat(e.code,"\uff09"),t,"topRight")}}})},n.cancelPre=function(e){u["a"].confirm({title:"\u8bf7\u60a8\u786e\u8ba4\u662f\u5426\u64a4\u9500\u8be5\u6761\u6d41\u7a0b\uff1f",icon:D.a.createElement(v["a"],null),content:"\u64a4\u9500\u540e\u8be5\u6d41\u7a0b\u5c06\u4e0d\u53ef\u6062\u590d",okText:"\u786e\u8ba4",cancelText:"\u53d6\u6d88",onOk:function(){return n.doCancel(e)}})},n._onFinish=function(){n.setState({selectedRowKeys:[],pageData:Object(m["a"])(Object(m["a"])({},n.state.pageData),{},{pageNum:1})}),n.getListData()},n._reset=function(){n.state.pageData.pageNum=1,n.formRef.current.resetFields(),n.getListData(),n.setState({selectedRowKeys:[]})},n.crateFlow=function(e){n.setState({crateFlowModalFlag:e})},n.goDetail=function(e){F["c"].push("/productLifeCycleInfo/list/processDetails/".concat(e.lifecycleFlowId))},n.goProductDetail=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{productId:0};F["c"].push("/product/list/details/".concat(e.productId))},n._onSelectChange=function(e){n.setState({selectedRowKeys:e})},n._tableChange=function(e,t,a){n.state.pageData.pageNum=e.current,n.state.pageData.pageSize=e.pageSize,n.getListData()},n.state={loading:!1,selectedRowKeys:[],dataSource:{},pageData:{pageNum:1,pageSize:20},crateFlowModalFlag:!1,handlePersion:[]},n}return Object(E["a"])(a,[{key:"componentDidMount",value:function(){this.getListData()}},{key:"render",value:function(){var e=this,t=this.state,a=t.loading,u=t.dataSource,m=t.pageData,f=t.selectedRowKeys,g=t.crateFlowModalFlag,h=(t.handlePersion,{selectedRowKeys:f,onChange:this._onSelectChange});return D.a.createElement(I["a"],null,D.a.createElement(n["a"],{style:{marginTop:15}},D.a.createElement(b["a"],Object(l["a"])({name:"basic",onFinish:this._onFinish,ref:this.formRef},U),D.a.createElement(r["a"],{gutter:[8,0]},D.a.createElement(d["a"],{span:8},D.a.createElement(j["b"],{params:"productIds",value:"productId",label:"productName",mode:"multiple",formLabel:"\u4ea7\u54c1\u540d\u79f0"})),D.a.createElement(d["a"],{span:8},D.a.createElement(M,{label:"\u6d41\u7a0b\u6807\u9898",name:"processTitle"},D.a.createElement(s["a"],{placeholder:"\u8bf7\u8f93\u5165",allowClear:!0}))),D.a.createElement(d["a"],{span:8},D.a.createElement(M,{label:"\u521b\u5efa\u65f6\u95f4",name:"createTime"},D.a.createElement(i["a"],{style:{width:"100%"},format:"YYYY-MM-DD",allowClear:!0}))),D.a.createElement(d["a"],{span:8},D.a.createElement(M,{label:"\u72b6\u6001",name:"flowStatus"},D.a.createElement(o["a"],{placeholder:"\u8bf7\u9009\u62e9",allowClear:!0},L["y"].map((function(e){return D.a.createElement(o["a"].Option,{key:e.value,value:e.value},e.label)}))))),D.a.createElement(d["a"],{span:8},D.a.createElement(M,{label:"\u5904\u7406\u4eba",name:"managerUserName"},D.a.createElement(s["a"],{placeholder:"\u8bf7\u8f93\u5165",allowClear:!0}))),D.a.createElement(d["a"],{span:8,style:{textAlign:"end"}},D.a.createElement(p["b"],null,D.a.createElement(c["a"],{type:"primary",htmlType:"submit"},"\u67e5\u8be2"),D.a.createElement(c["a"],{onClick:this._reset},"\u91cd\u7f6e"))))),D.a.createElement(r["a"],null,D.a.createElement(p["b"],null,H&&D.a.createElement(c["a"],{type:"primary",onClick:function(){return e.crateFlow(!0)}},"\u521b\u5efa\u6d41\u7a0b"),H&&D.a.createElement(c["a"],{danger:!0,disabled:0===f.length,onClick:function(){return e.cancelPre(f)}},"\u64a4\u9500"))),D.a.createElement(R["a"],{loading:a,rowSelection:h,columns:this.columns,dataSource:u.list||[],rowKey:"lifecycleFlowId",scroll:{x:"100%",scrollToFirstRowOnChange:!0},sticky:!0,total:u.total,pageNum:m.pageNum,onChange:this._tableChange})),g&&D.a.createElement(S,{flag:g,onClose:function(){return e.crateFlow(!1)},goProductDetail:this.goProductDetail,onSuccess:function(){return e.crateFlow(!1)}}))}}]),a}(O["Component"]));t["default"]=Object(F["b"])((function(e){var t=e.loading;return{loading:t.effects["PRODUCTLIFECYCLEINFO/getListData"]}}))(Q)}}]);